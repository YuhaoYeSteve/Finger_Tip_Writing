# 指尖书写产品迭代计划 (Finger Tip Writing Iteration Plan)

## 1. 核心痛点解决：优化书写控制机制

目前的问题是“只要检测到食指就一直在写”，导致无法写出独立的笔画（如汉字的横竖撇捺），且容易误触。

**解决方案：引入“捏合落笔”手势 (Pinch to Draw)**

利用 MediaPipe Hands 提供的食指指尖 (Index Tip, ID: 8) 和拇指指尖 (Thumb Tip, ID: 4) 的距离来控制笔触状态。

* **落笔状态 (Draw Mode)**：当食指与拇指**捏合**（距离小于特定阈值，如 0.05）时，视为“按下”，开始绘制线条。

* **悬停状态 (Hover Mode)**：当食指与拇指**张开**时，视为“抬起”，此时只移动光标位置，不产生笔迹。

**视觉反馈优化**：

* **悬停时**：光标显示为空心圆圈，跟随食指指尖移动，方便用户瞄准落笔点。

* **落笔时**：光标变为实心圆点（当前选择的颜色），并伴随微小的缩放动画，模拟压感反馈。

## 2. 新功能：录屏与保存

响应用户需求，增加记录创作过程的功能。

**功能细则**：

* **录屏功能**：

  * 新增“开始录制 / 停止录制”按钮。

  * 使用 `Canvas.captureStream()` 和 `MediaRecorder` API 录制画布内容。

  * 录制包含摄像头画面背景和前景笔迹（所见即所得）。

  * 录制完成后自动触发下载 `.webm` 格式视频文件。

  * 添加录制状态指示器（如红点闪烁）。

* **保存图片**：

  * 新增“保存截图”按钮。

  * 将当前画布内容导出为 `.png` 图片下载。

## 3. 体验优化：笔迹平滑算法

直接使用原始坐标会导致线条抖动（因为手部微颤和检测误差）。

**解决方案**：

* 引入**指数移动平均 (Exponential Moving Average)** 算法。

* 当前坐标不是直接等于检测坐标，而是：`Current = Previous * 0.5 + Detected * 0.5`。

* 使线条更加圆润流畅，提升书写质感。

## 4. 界面 (UI) 迭代

* **工具栏重构**：将功能分类（画笔设置、操作工具、记录工具）。

* **状态提示**：在屏幕角落添加简短的操作指引（如“捏合手指开始书写”）。

***

## 开发任务列表 (Todo List)

### Phase 1: 交互重构 (Interaction Refactor)

* [ ] 修改 `script.js`，增加计算食指与拇指距离的函数。

* [ ] 实现“悬停”与“落笔”的状态机切换逻辑。

* [ ] 更新光标渲染逻辑：悬停显示空心，捏合显示实心。

* [ ] 实现简单的坐标平滑算法，优化线条质量。

### Phase 2: 录制功能 (Recording Features)

* [ ] 在 `index.html` 添加录屏和保存图片按钮。

* [ ] 在 `script.js` 中实现 `MediaRecorder` 录制逻辑。

* [ ] 实现视频文件的生成与下载触发。

* [ ] 实现 Canvas 截图导出功能。

### Phase 3: UI 完善

* [ ] 更新 `style.css`，美化新增的按钮和状态指示器。

* [ ] 添加简单的用户引导提示文案。

